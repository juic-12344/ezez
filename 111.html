<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å¢è‚Œé£²é£ŸæŸ¥è©¢</title>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: 'Arial', sans-serif; padding: 2rem; background-color: #f4f4f4; }
    h1 { text-align: center; color: #2c3e50; }
    .container { max-width: 800px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
    input, button { padding: 10px; font-size: 16px; width: 100%; margin-bottom: 15px; border-radius: 4px; border: 1px solid #ccc; }
    button { background-color: #3498db; color: white; cursor: pointer; border: none; }
    button:hover { background-color: #2980b9; }
    #result { margin-top: 20px; padding: 10px; border-radius: 8px; background-color: #ecf0f1; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
    .food-result { background-color: #ffffff; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
    .food-result h3 { margin: 0; color: #3498db; }
    .form-container { margin-top: 30px; background-color: #ecf0f1; padding: 20px; border-radius: 8px; }
    .form-container input { width: calc(100% - 22px); margin-bottom: 10px; }
    .form-container button { width: 100%; }
    #todayLog { margin-top: 20px; }
    #nutritionGap { margin-top: 20px; font-weight: bold; }
    #suggestions { margin-top: 20px; padding: 15px; background-color: #d5f4e6; border-radius: 8px; }
    #suggestions h3 { color: #27ae60; }
  </style>
</head>
<body>

  <h1>ğŸ’ª å¢è‚Œé£²é£Ÿç´€éŒ„</h1>

  <div class="container">
    <!-- æŸ¥è©¢é£Ÿç‰© -->
    <input type="text" id="foodInput" placeholder="è¼¸å…¥é£Ÿç‰©åç¨±">
    <button onclick="searchFood()">æŸ¥è©¢é£Ÿç‰©</button>

    <div id="result"></div>

    <!-- è¨˜éŒ„ä»Šå¤©åƒçš„é£Ÿç‰© -->
    <div class="form-container">
      <h2>è¨˜éŒ„ä»Šå¤©åƒçš„é£Ÿç‰©</h2>
      <div id="foodList"></div> <!-- é¡¯ç¤ºé£Ÿç‰©é¸æ“‡åˆ—è¡¨ -->
      

      <div id="todayLog"></div>
    </div>

    <!-- é¡¯ç¤ºç‡Ÿé¤Šç¼ºå£ -->
    <div id="nutritionGap"></div>

    <!-- é¡¯ç¤ºå»ºè­° -->
    <div id="suggestions">
      <h3>é£²é£Ÿå»ºè­°</h3>
      <p>æ ¹æ“šä½ çš„ä»Šæ—¥é£²é£Ÿç´€éŒ„ï¼Œé€™æ˜¯ä½ çš„å»ºè­°ï¼š</p>
      <div id="suggestionsList"></div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBjNxuvprAQhZIBh5GZut1IQ2SnwEo9KIs",
      authDomain: "food-991cc.firebaseapp.com",
      projectId: "food-991cc",
      storageBucket: "food-991cc.firebasestorage.app",
      messagingSenderId: "821021452028",
      appId: "1:821021452028:web:ebf495b1a3753026d0d979",
      measurementId: "G-RTEVZXDTHY"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let totalCalories = 0;
    let totalProtein = 0;
    let totalCarbs = 0;
    let totalFat = 0;

    let selectedFoods = []; // å„²å­˜å·²é¸æ“‡çš„é£Ÿç‰©åŠå…¶é‡é‡

    // æŸ¥è©¢é£Ÿç‰©
    async function searchFood() {
      const name = document.getElementById("foodInput").value.trim();
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "æŸ¥è©¢ä¸­...";

      try {
        const query = await db.collection("foods").where("name", "==", name).get();
        if (query.empty) {
          resultDiv.innerHTML = "æ‰¾ä¸åˆ°é€™å€‹é£Ÿç‰©ã€‚";
          return;
        }

        const data = query.docs[0].data();
        resultDiv.innerHTML = `
          <div class="food-result">
            <h3>${data.name}</h3>
            <p>ç†±é‡ï¼š${data.calories} kcal</p>
            <p>è›‹ç™½è³ªï¼š${data.protein} g</p>
            <p>ç¢³æ°´ï¼š${data.carbs} g</p>
            <p>è„‚è‚ªï¼š${data.fat} g</p>
          </div>
        `;

        // é¡¯ç¤ºé£Ÿç‰©é¸æ“‡åˆ—è¡¨
        displayFoodList(data);

      } catch (err) {
        resultDiv.innerHTML = "éŒ¯èª¤ï¼š" + err.message;
      }
    }

    // é¡¯ç¤ºé£Ÿç‰©é¸æ“‡åˆ—è¡¨
    function displayFoodList(food) {
      const foodListDiv = document.getElementById("foodList");
      foodListDiv.innerHTML = `
        <div>
          <label for="foodAmount">é‡é‡ (å…‹)ï¼š</label>
          <input type="number" id="foodAmount" min="1" placeholder="è¼¸å…¥é£Ÿç‰©çš„å…‹æ•¸" />
          <button onclick="addFoodToLog('${food.name}', ${food.calories}, ${food.protein}, ${food.carbs}, ${food.fat})">æ·»åŠ é£Ÿç‰©</button>
        </div>
      `;
    }

    // è¨˜éŒ„é¸æ“‡çš„é£Ÿç‰©
    function addFoodToLog(name, calories, protein, carbs, fat) {
      const amount = document.getElementById("foodAmount").value;
      if (!amount || amount <= 0) {
        alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„å…‹æ•¸ï¼");
        return;
      }

      // è¨ˆç®—æ ¹æ“šå…‹æ•¸çš„ç‡Ÿé¤Šæ•¸æ“š
      const amountFactor = amount / 100; // ä»¥æ¯100å…‹ç‚ºåŸºæº–
      const foodCalories = calories * amountFactor;
      const foodProtein = protein * amountFactor;
      const foodCarbs = carbs * amountFactor;
      const foodFat = fat * amountFactor;

      selectedFoods.push({ name, amount, foodCalories, foodProtein, foodCarbs, foodFat });

      // æ›´æ–°ç¸½ç‡Ÿé¤Šæ•¸æ“š
      totalCalories += foodCalories;
      totalProtein += foodProtein;
      totalCarbs += foodCarbs;
      totalFat += foodFat;

      // é¡¯ç¤ºä»Šæ—¥é£Ÿç‰©
      updateTodayLog();
      updateNutritionGap();
      giveSuggestions();
    }

    // æ›´æ–°ä»Šæ—¥é£Ÿç‰©æ¸…å–®
    function updateTodayLog() {
      const todayLogDiv = document.getElementById("todayLog");
      let logContent = "<h3>ä»Šå¤©åƒäº†ï¼š</h3>";

      selectedFoods.forEach(food => {
        logContent += `
          <p>${food.name} (${food.amount} å…‹) - ç†±é‡: ${food.foodCalories.toFixed(2)} kcal, è›‹ç™½è³ª: ${food.foodProtein.toFixed(2)} g, ç¢³æ°´: ${food.foodCarbs.toFixed(2)} g, è„‚è‚ª: ${food.foodFat.toFixed(2)} g</p>
        `;
      });

      todayLogDiv.innerHTML = logContent;
    }

    // é¡¯ç¤ºç‡Ÿé¤Šç¼ºå£
    function updateNutritionGap() {
      const targetCalories = 3000;
      const targetProtein = 150;
      const targetCarbs = 400;
      const targetFat = 100;

      const gapCalories = targetCalories - totalCalories;
      const gapProtein = targetProtein - totalProtein;
      const gapCarbs = targetCarbs - totalCarbs;
      const gapFat = targetFat - totalFat;

      const nutritionGapDiv = document.getElementById("nutritionGap");
      nutritionGapDiv.innerHTML = `
        <p>å‰©é¤˜ç†±é‡ï¼š${gapCalories.toFixed(2)} kcal</p>
        <p>å‰©é¤˜è›‹ç™½è³ªï¼š${gapProtein.toFixed(2)} g</p>
        <p>å‰©é¤˜ç¢³æ°´ï¼š${gapCarbs.toFixed(2)} g</p>
        <p>å‰©é¤˜è„‚è‚ªï¼š${gapFat.toFixed(2)} g</p>
      `;
    }

    // é¡¯ç¤ºé£²é£Ÿå»ºè­°
    function giveSuggestions() {
      let suggestions = [];
      
      if (totalProtein < 150) {
        suggestions.push("ä»Šå¤©è›‹ç™½è³ªæ”å–ä¸è¶³ï¼Œå»ºè­°å¢åŠ è›‹ç™½è³ªé£Ÿç‰©å¦‚é›èƒ¸è‚‰ã€è›‹ç™½ç²‰ç­‰ã€‚");
      }
      if (totalCarbs > 400) {
        suggestions.push("ä»Šå¤©ç¢³æ°´æ”å–éå¤šï¼Œå»ºè­°æ¸›å°‘ç¢³æ°´ä¾†æºå¦‚ç±³é£¯ã€éºµé£Ÿç­‰ã€‚");
      }
      if (totalFat < 100) {
        suggestions.push("ä»Šå¤©è„‚è‚ªæ”å–ä¸è¶³ï¼Œå»ºè­°å¢åŠ å¥åº·è„‚è‚ªå¦‚ç‰›æ²¹æœã€æ©„æ¬–æ²¹ç­‰ã€‚");
      }

      const suggestionsList = document.getElementById("suggestionsList");
      suggestionsList.innerHTML = suggestions.length ? suggestions.join('<br>') : "ä½ çš„é£²é£Ÿä»Šå¤©å¾ˆæ£’ï¼Œä¿æŒé€™æ¨£ï¼";
    }
  </script>

</body>
</html>




